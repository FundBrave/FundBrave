# ===========================================
# FundBrave Backend Environment Configuration
# ===========================================

# ===========================================
# Database Configuration
# ===========================================
#
# Standard PostgreSQL connection:
# DATABASE_URL="postgresql://user:password@localhost:5432/fundbrave?schema=public"
#
# ===========================================
# Supabase Connection Pool Configuration
# ===========================================
#
# Supabase uses PgBouncer for connection pooling. Choose the appropriate mode:
#
# 1. TRANSACTION MODE (Recommended for serverless/API)
#    - Port: 6543
#    - Connections released after each transaction
#    - Best for: NestJS APIs, serverless functions, short-lived connections
#    - Required params: pgbouncer=true, connection_limit (typically 1-10)
#    - Example:
#    DATABASE_URL="postgres://[user]:[password]@db.[project-ref].supabase.co:6543/postgres?pgbouncer=true&connection_limit=10&pool_timeout=20&connect_timeout=10"
#
# 2. SESSION MODE (Direct Connection)
#    - Port: 5432
#    - Connection persists for entire session
#    - Best for: Migrations, LISTEN/NOTIFY, prepared statements, advisory locks
#    - Example:
#    DATABASE_URL="postgres://[user]:[password]@db.[project-ref].supabase.co:5432/postgres"
#
# Connection Pool Parameters:
# - connection_limit: Max connections from this client (Supabase free tier: ~15 total)
# - pool_timeout: Seconds to wait for available connection (default: 10)
# - connect_timeout: Seconds for initial connection (default: 10)
# - statement_cache_size: Set to 0 when using pgbouncer in transaction mode
#
# For Prisma with Supabase Transaction Pooler, use:
# DATABASE_URL="postgres://[user]:[password]@db.[project-ref].supabase.co:6543/postgres?pgbouncer=true&connection_limit=10&pool_timeout=20"
#
# IMPORTANT: The connection_limit should be set based on your Supabase plan:
# - Free tier: connection_limit=5 (shared pool of ~15 connections)
# - Pro tier: connection_limit=15 (shared pool of ~60 connections)
# - Higher tiers: Adjust based on your plan limits
#
DATABASE_URL="postgresql://user:password@localhost:5432/fundbrave?schema=public"

# ===========================================
# Authentication & Security
# ===========================================

# JWT Configuration
JWT_SECRET="your-super-secret-jwt-key-min-32-chars"
JWT_EXPIRES_IN="1d"
JWT_REFRESH_SECRET="your-super-secret-refresh-key-min-32-chars"
JWT_REFRESH_EXPIRES_IN="7d"

# Encryption (for managed wallets - must be 64 hex characters = 32 bytes)
WALLET_ENCRYPTION_KEY="0000000000000000000000000000000000000000000000000000000000000000"

# ===========================================
# OAuth Providers
# ===========================================

# Google OAuth 2.0
# Setup instructions:
# 1. Go to Google Cloud Console: https://console.cloud.google.com/
# 2. Create a new project or select existing one
# 3. Enable "Google+ API" and "Google Identity" APIs
# 4. Go to "Credentials" > "Create Credentials" > "OAuth 2.0 Client ID"
# 5. Set Application Type to "Web application"
# 6. Add authorized redirect URI: http://localhost:3000/auth/google/callback (for development)
# 7. For production, add: https://api.yourdomain.com/auth/google/callback
# 8. Copy Client ID and Client Secret below
#
# IMPORTANT: The callback URL must match EXACTLY what's configured in Google Console
GOOGLE_CLIENT_ID=""
GOOGLE_CLIENT_SECRET=""
GOOGLE_CALLBACK_URL="http://localhost:3000/auth/google/callback"

# OAuth Security Notes:
# - State parameter is enabled by default for CSRF protection
# - Google access/refresh tokens are NOT stored (we use our own JWT tokens)
# - New OAuth users get a managed wallet created automatically
# - Existing users with matching email get their Google ID linked

# ===========================================
# Redis Configuration
# ===========================================

REDIS_HOST="localhost"
REDIS_PORT=6379
REDIS_PASSWORD=""

# ===========================================
# AWS S3 Configuration (File Uploads)
# ===========================================

AWS_ACCESS_KEY_ID=""
AWS_SECRET_ACCESS_KEY=""
AWS_S3_BUCKET="fundbrave-media"
AWS_REGION="us-east-1"

# ===========================================
# Email Service (SMTP)
# ===========================================

SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_USER=""
SMTP_PASS=""
SMTP_FROM="FundBrave <noreply@fundbrave.com>"

# ===========================================
# Blockchain Configuration
# ===========================================

ALCHEMY_API_KEY=""
ETHEREUM_RPC="https://eth-mainnet.g.alchemy.com/v2/<KEY>"
POLYGON_RPC="https://polygon-mainnet.g.alchemy.com/v2/<KEY>"
AVALANCHE_RPC="https://api.avax.network/ext/bc/C/rpc"
ARBITRUM_RPC="https://arb-mainnet.g.alchemy.com/v2/<KEY>"
OPTIMISM_RPC="https://opt-mainnet.g.alchemy.com/v2/<KEY>"

# Contract Addresses (per network)
FACTORY_ADDRESS_ETH="0x..."
FACTORY_ADDRESS_POLYGON="0x..."
FACTORY_ADDRESS_AVALANCHE="0x..."
FACTORY_ADDRESS_ARBITRUM="0x..."
FACTORY_ADDRESS_OPTIMISM="0x..."

# Global Staking Pool Addresses
GLOBAL_STAKING_POOL_ETH="0x..."
GLOBAL_STAKING_POOL_POLYGON="0x..."

# FBT Token Addresses
FBT_TOKEN_ETH="0x..."
FBT_TOKEN_POLYGON="0x..."

# The Graph
SUBGRAPH_URL="https://api.thegraph.com/subgraphs/name/your-org/fundbrave"

# ===========================================
# Application Settings
# ===========================================

PORT=3000
NODE_ENV="development"
FRONTEND_URL="http://localhost:3001"

# Admin Wallet Addresses (comma-separated for multiple admins)
ADMIN_WALLET_ADDRESSES="0x..."

# ===========================================
# Rate Limiting
# ===========================================

# Default rate limits (requests per minute)
THROTTLE_TTL=60000
THROTTLE_LIMIT=100

# ===========================================
# Health Check Configuration
# ===========================================

# Memory thresholds (in bytes)
HEALTH_HEAP_THRESHOLD=150000000
HEALTH_RSS_THRESHOLD=150000000

# Disk threshold (percentage, 0-1)
HEALTH_DISK_THRESHOLD=0.9