# ===========================================
# FundBrave Backend Environment Configuration
# ===========================================

# ===========================================
# Database Configuration
# ===========================================
#
# Standard PostgreSQL connection:
# DATABASE_URL="postgresql://user:password@localhost:5432/fundbrave?schema=public"
#
# ===========================================
# Supabase Connection Pool Configuration
# ===========================================
#
# Supabase uses PgBouncer for connection pooling. Choose the appropriate mode:
#
# 1. TRANSACTION MODE (Recommended for serverless/API)
#    - Port: 6543
#    - Connections released after each transaction
#    - Best for: NestJS APIs, serverless functions, short-lived connections
#    - Required params: pgbouncer=true, connection_limit (typically 1-10)
#    - Example:
#    DATABASE_URL="postgres://[user]:[password]@db.[project-ref].supabase.co:6543/postgres?pgbouncer=true&connection_limit=10&pool_timeout=20&connect_timeout=10"
#
# 2. SESSION MODE (Direct Connection)
#    - Port: 5432
#    - Connection persists for entire session
#    - Best for: Migrations, LISTEN/NOTIFY, prepared statements, advisory locks
#    - Example:
#    DATABASE_URL="postgres://[user]:[password]@db.[project-ref].supabase.co:5432/postgres"
#
# Connection Pool Parameters:
# - connection_limit: Max connections from this client (Supabase free tier: ~15 total)
# - pool_timeout: Seconds to wait for available connection (default: 10)
# - connect_timeout: Seconds for initial connection (default: 10)
# - statement_cache_size: Set to 0 when using pgbouncer in transaction mode
#
# For Prisma with Supabase Transaction Pooler, use:
# DATABASE_URL="postgres://[user]:[password]@db.[project-ref].supabase.co:6543/postgres?pgbouncer=true&connection_limit=10&pool_timeout=20"
#
# IMPORTANT: The connection_limit should be set based on your Supabase plan:
# - Free tier: connection_limit=5 (shared pool of ~15 connections)
# - Pro tier: connection_limit=15 (shared pool of ~60 connections)
# - Higher tiers: Adjust based on your plan limits
#
DATABASE_URL="postgresql://user:password@localhost:5432/fundbrave?schema=public"

# ===========================================
# Authentication & Security
# ===========================================

# JWT Configuration
JWT_SECRET="your-super-secret-jwt-key-min-32-chars"
JWT_EXPIRES_IN="1d"
JWT_REFRESH_SECRET="your-super-secret-refresh-key-min-32-chars"
JWT_REFRESH_EXPIRES_IN="7d"

# Encryption (for managed wallets - must be 64 hex characters = 32 bytes)
WALLET_ENCRYPTION_KEY="0000000000000000000000000000000000000000000000000000000000000000"

# ===========================================
# OAuth Providers
# ===========================================

# Google OAuth 2.0
# Setup instructions:
# 1. Go to Google Cloud Console: https://console.cloud.google.com/
# 2. Create a new project or select existing one
# 3. Enable "Google+ API" and "Google Identity" APIs
# 4. Go to "Credentials" > "Create Credentials" > "OAuth 2.0 Client ID"
# 5. Set Application Type to "Web application"
# 6. Add authorized redirect URI: http://localhost:3000/auth/google/callback (for development)
# 7. For production, add: https://api.yourdomain.com/auth/google/callback
# 8. Copy Client ID and Client Secret below
#
# IMPORTANT: The callback URL must match EXACTLY what's configured in Google Console
GOOGLE_CLIENT_ID=""
GOOGLE_CLIENT_SECRET=""
GOOGLE_CALLBACK_URL="http://localhost:3000/auth/google/callback"

# OAuth Security Notes:
# - State parameter is enabled by default for CSRF protection
# - Google access/refresh tokens are NOT stored (we use our own JWT tokens)
# - New OAuth users get a managed wallet created automatically
# - Existing users with matching email get their Google ID linked

# ===========================================
# Redis Configuration
# ===========================================

REDIS_HOST="localhost"
REDIS_PORT=6379
REDIS_PASSWORD=""

# ===========================================
# AWS S3 Configuration (File Uploads)
# ===========================================

AWS_ACCESS_KEY_ID=""
AWS_SECRET_ACCESS_KEY=""
AWS_S3_BUCKET="fundbrave-media"
AWS_REGION="us-east-1"

# ===========================================
# Email Service (SMTP)
# ===========================================

SMTP_HOST="smtp.gmail.com"
SMTP_PORT=587
SMTP_USER=""
SMTP_PASS=""
SMTP_FROM="FundBrave <noreply@fundbrave.com>"

# ===========================================
# Blockchain Configuration
# ===========================================

# Default chain ID for the application
# Set to 84532 for Base Sepolia testnet, 8453 for Base mainnet
DEFAULT_CHAIN_ID=84532

# Backend wallet private key for signing transactions
# REQUIRED for blockchain write operations (creating fundraisers, etc.)
# Generate a new wallet for backend use - DO NOT use a personal wallet
# Must be a 64-character hex string (with or without 0x prefix)
# Example: 0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
BACKEND_WALLET_PK=""

# ===========================================
# RPC Provider Configuration (Priority Order)
# ===========================================
# The backend uses a FallbackProvider with multiple RPC endpoints.
# Configure at least one reliable endpoint for each network you need.
# Priority: Alchemy > QuickNode > Custom RPC > Public endpoints

# Alchemy API Key (HIGHLY RECOMMENDED)
# Get one free at: https://www.alchemy.com/
# Provides reliable connections with higher rate limits
ALCHEMY_API_KEY=""

# QuickNode Configuration (Optional, for additional redundancy)
# Get one at: https://www.quicknode.com/
QUICKNODE_API_KEY=""
QUICKNODE_BASE_SEPOLIA_URL=""
QUICKNODE_BASE_MAINNET_URL=""

# Legacy RPC URLs (still supported for backward compatibility)
ETHEREUM_RPC="https://eth-mainnet.g.alchemy.com/v2/<KEY>"
POLYGON_RPC="https://polygon-mainnet.g.alchemy.com/v2/<KEY>"
AVALANCHE_RPC="https://api.avax.network/ext/bc/C/rpc"
ARBITRUM_RPC="https://arb-mainnet.g.alchemy.com/v2/<KEY>"
OPTIMISM_RPC="https://opt-mainnet.g.alchemy.com/v2/<KEY>"

# ===========================================
# Base Sepolia Testnet Configuration (Primary Testnet)
# ===========================================
# Chain ID: 84532
# RPC URL: https://sepolia.base.org (public, rate-limited)
# Block Explorer: https://sepolia.basescan.org
#
# NOTE: The public RPC (https://sepolia.base.org) is rate-limited and may
# cause "JsonRpcProvider failed to detect network" errors. For reliable
# operation, configure ALCHEMY_API_KEY above which will automatically use:
# https://base-sepolia.g.alchemy.com/v2/<your-key>
#
# Alternative: Use a custom RPC URL here (e.g., from QuickNode or Infura)
BASE_SEPOLIA_RPC_URL="https://sepolia.base.org"

# Base Sepolia Deployed Contracts
BASE_SEPOLIA_FBT="0xE42A6ff84160Ac399607667C32392378Bbb270E0"
BASE_SEPOLIA_FUNDRAISER_FACTORY="0x7253b4E79cc708873b83Bb3C3F50F3e81b21819c"
BASE_SEPOLIA_FUNDRAISER_IMPL="0xf79732B4D25521F2C8d8619c568C065fBf69bc9e"
BASE_SEPOLIA_STAKING_POOL_IMPL="0x51A41B4F07a7b5b6D2eF72E3AaD97aDE1e3E86F8"
BASE_SEPOLIA_WEALTH_BUILDING="0x8DcC63E7Df76ece01c186568E269a2cF3aC8A886"
BASE_SEPOLIA_PLATFORM_TREASURY="0x664AbB27C9c3d287117676c77B6A1c88B831D836"
BASE_SEPOLIA_USDC="0x036CbD53842c5426634e7929541eC2318f3dCF7e"
BASE_SEPOLIA_IMPACT_DAO_POOL=""
BASE_SEPOLIA_AUSDC=""
BASE_SEPOLIA_AAVE_POOL=""

# ===========================================
# Base Mainnet Configuration (Production)
# ===========================================
# Chain ID: 8453

BASE_RPC_URL="https://mainnet.base.org"
BASE_FBT=""
BASE_FUNDRAISER_FACTORY=""
BASE_WEALTH_BUILDING=""
BASE_PLATFORM_TREASURY=""
BASE_IMPACT_DAO_POOL=""
BASE_USDC="0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"
BASE_AUSDC=""
BASE_AAVE_POOL="0xA238Dd80C259a72e81d7e4664a9801593F98d1c5"

# ===========================================
# Legacy Network Configuration
# ===========================================

# Contract Addresses (per network)
FACTORY_ADDRESS_ETH="0x..."
FACTORY_ADDRESS_POLYGON="0x..."
FACTORY_ADDRESS_AVALANCHE="0x..."
FACTORY_ADDRESS_ARBITRUM="0x..."
FACTORY_ADDRESS_OPTIMISM="0x..."

# Global Staking Pool Addresses
GLOBAL_STAKING_POOL_ETH="0x..."
GLOBAL_STAKING_POOL_POLYGON="0x..."

# FBT Token Addresses
FBT_TOKEN_ETH="0x..."
FBT_TOKEN_POLYGON="0x..."

# The Graph
SUBGRAPH_URL="https://api.thegraph.com/subgraphs/name/your-org/fundbrave"

# ===========================================
# Application Settings
# ===========================================

PORT=3000
NODE_ENV="development"
FRONTEND_URL="http://localhost:3001"

# Admin Wallet Addresses (comma-separated for multiple admins)
ADMIN_WALLET_ADDRESSES="0x..."

# ===========================================
# Rate Limiting
# ===========================================

# Default rate limits (requests per minute)
THROTTLE_TTL=60000
THROTTLE_LIMIT=100

# ===========================================
# Health Check Configuration
# ===========================================

# Memory thresholds (in bytes)
HEALTH_HEAP_THRESHOLD=150000000
HEALTH_RSS_THRESHOLD=150000000

# Disk threshold (percentage, 0-1)
HEALTH_DISK_THRESHOLD=0.9

# ===========================================
# Database Seeding Configuration
# ===========================================

# Enable on-chain campaign seeding
# When enabled, campaigns are created on the actual blockchain (Base Sepolia)
# instead of using fake transaction hashes.
#
# Requirements:
# - BACKEND_WALLET_PK must be set with a funded wallet (needs ETH for gas)
# - RPC connection to Base Sepolia must be working
#
# Usage options:
# 1. Set this to true and run: npm run seed
# 2. Keep false and run: npm run seed -- --onchain
# 3. Run on-chain seeding only: npm run seed:campaigns
#
# WARNING: On-chain seeding is slower (requires blockchain confirmations)
# and costs gas. Each campaign creation costs approximately 0.001-0.005 ETH.
#
SEED_ONCHAIN_CAMPAIGNS=false